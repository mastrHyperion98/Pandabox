<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package 
    Name="Pandabox" 
    Manufacturer="mastrHyperion98" 
    Version="0.1.1.0"
    UpgradeCode="A1B2C3D4-E5F6-4A5B-8C9D-0E1F2A3B4C5D">
    
    <MajorUpgrade 
      DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    
    <MediaTemplate EmbedCab="yes" />
    
    <!-- Icon for shortcuts and Add/Remove Programs -->
    <Icon Id="PandaboxIcon" SourceFile="assets\icon.ico" />
    <Property Id="ARPPRODUCTICON" Value="PandaboxIcon" />
    
    <!-- Add/Remove Programs properties -->
    <Property Id="ARPHELPLINK" Value="https://github.com/mastrHyperion98/Pandabox" />
    <Property Id="ARPURLINFOABOUT" Value="https://github.com/mastrHyperion98/Pandabox" />
    <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />
    
    <!-- Installation directory -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="Pandabox">
        <Directory Id="BIN_DIR" Name="bin" />
      </Directory>
    </StandardDirectory>
    
    <!-- Start Menu -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Pandabox" />
    </StandardDirectory>
    
    <!-- Desktop -->
    <StandardDirectory Id="DesktopFolder" />
    
    <!-- Main application files component -->
    <ComponentGroup Id="ProductComponents" Directory="BIN_DIR">
      <Component Id="PandaboxExe" Guid="B2C3D4E5-F6A7-4B5C-8D9E-0F1A2B3C4D5E">
        <File Id="PandaboxExeFile" 
              Source="..\target\release\Pandabox.exe" 
              KeyPath="yes" />
        
        <!-- Registry entry for uninstaller -->
        <RegistryValue Root="HKCU" 
                      Key="Software\mastrHyperion98\Pandabox" 
                      Name="installed" 
                      Type="integer" 
                      Value="1" 
                      KeyPath="no" />
      </Component>
    </ComponentGroup>
    
    <!-- Desktop Shortcut -->
    <Component Id="DesktopShortcut" Directory="DesktopFolder" Guid="C3D4E5F6-A7B8-4C5D-8E9F-0A1B2C3D4E5F">
      <Shortcut Id="DesktopShortcutId"
                Name="Pandabox"
                Description="Secure Password Manager"
                Target="[BIN_DIR]Pandabox.exe"
                WorkingDirectory="BIN_DIR"
                Icon="PandaboxIcon" />
      <RemoveFolder Id="RemoveDesktopFolder" On="uninstall" />
      <RegistryValue Root="HKCU" 
                    Key="Software\mastrHyperion98\Pandabox" 
                    Name="DesktopShortcut" 
                    Type="integer" 
                    Value="1" 
                    KeyPath="yes" />
    </Component>
    
    <!-- Start Menu Shortcut -->
    <Component Id="StartMenuShortcut" Directory="ApplicationProgramsFolder" Guid="D4E5F6A7-B8C9-4D5E-8F9A-0B1C2D3E4F5A">
      <Shortcut Id="StartMenuShortcutId"
                Name="Pandabox"
                Description="Secure Password Manager"
                Target="[BIN_DIR]Pandabox.exe"
                WorkingDirectory="BIN_DIR"
                Icon="PandaboxIcon" />
      <RemoveFolder Id="RemoveStartMenuFolder" On="uninstall" />
      <RegistryValue Root="HKCU" 
                    Key="Software\mastrHyperion98\Pandabox" 
                    Name="StartMenuShortcut" 
                    Type="integer" 
                    Value="1" 
                    KeyPath="yes" />
    </Component>
    
    <!-- Features -->
    <Feature Id="ProductFeature" Title="Pandabox" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentGroupRef Id="DependencyComponents" />
      <ComponentRef Id="DesktopShortcut" />
      <ComponentRef Id="StartMenuShortcut" />
    </Feature>
  </Package>
</Wix>
