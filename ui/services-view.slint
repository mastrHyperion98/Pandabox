import { Button } from "std-widgets.slint";
import { Palette, StandardTableView, ScrollView, StyleMetrics, LineEdit } from "std-widgets.slint";
import { ServiceForm, ServiceData } from "service-form.slint";


// Define a global property that will hold our table data
export global AppData {
    in-out property <[[StandardListViewItem]]> table-rows: [
        [
            { text: "Netflix" },
            { text: "email_abc@def.com" },
            { text: "NotARealUser" },
            { text: "NotAPassword" },
            { text: "Netflix & Chill creds" },
            { text: "2026-01-01T10:12:23" },
        ],
        [
            { text: "NotLastNetflix" },
            { text: "email_abc@def.com" },
            { text: "NotARealUser" },
            { text: "NotAPassword" },
            { text: "Netfli2 & Chill creds" },
            { text: "2026-01-01T10:12:23" },
        ],
    ];

    // Callback to trigger adding a row from the UI
    callback add-new-row(ServiceData);
}

export enum View {
    Form,
    Table
}

export component ServiceView{
    min-width: 1280px;
    min-height: 720px;
    
    // Form state management
    in-out property <View> show-state: View.Table;
    in-out property <string> form-mode: "Add New Entry";
    in-out property <ServiceData> current-service-data;
    
    callback generate_password()->string;

  // Main content area
  if root.show-state == View.Table: VerticalLayout {
      padding: 25px;
      spacing: 50px;
      
      HorizontalLayout {
          spacing: 25px;
          Button {
              text: "Add"; primary: true;
              clicked => {
                  root.form-mode = "Add";
                  root.current-service-data = {};
                  root.show-state = View.Form;
                  }
              }
          Button {
              text: "Edit";
              clicked => {
                  root.form-mode = "Edit";
                  // TODO: Set current-service-data from selected row
                  root.show-state = View.Form;
              }
          }
          Button {text: "Delete";}
          Button {text: "Duplicate & Refresh";}
      }

      StandardTableView {
          columns: [
              { title: "Application", min_width: 100px},
              { title: "Email", min_width: 100px },
              { title: "Username",min_width: 100px },
              { title: "Password", min_width: 100px },
              { title: "Description", min_width: 100px },
              { title: "Last Update",  min-width: 150px, horizontal_stretch: 0},
          ];
          // figure out how to dynamically set this data
          rows: AppData.table-rows;
      }
  }
  
  // Slide-in form (moved outside layout)
  if root.show-state == View.Form: Rectangle {
      width: parent.width;
      height: parent.height;

      ServiceForm {
          width: parent.width;
          height: parent.height;
          title: root.form-mode;
          service-data: root.current-service-data;

          save-pressed(data) => {
              // Handle save logic here
              AppData.add-new-row(data);
              root.show-state = View.Table;
          }

          cancel-pressed() => {
              root.show-state = View.Table;
          }

          generate-password() => {
              self.password = generate_password();
          }
      }
  }
 }